/**
 * Creates a minimal .nuxt/tsconfig.json stub so that Vite's esbuild transform
 * plugin can resolve the `"extends": "./.nuxt/tsconfig.json"` reference in
 * app/tsconfig.json without running `nuxt prepare` first.
 *
 * The real .nuxt/tsconfig.json is generated by Nuxt at dev/build time and is
 * gitignored. This stub is only needed for running tests on a clean checkout.
 */

import { mkdirSync, writeFileSync, existsSync } from 'node:fs'
import { join, dirname } from 'node:path'
import { fileURLToPath } from 'node:url'

const __dirname = dirname(fileURLToPath(import.meta.url))
const nuxtDir = join(__dirname, '..', '.nuxt')
const tsconfigPath = join(nuxtDir, 'tsconfig.json')

if (!existsSync(tsconfigPath)) {
  mkdirSync(nuxtDir, { recursive: true })
  writeFileSync(
    tsconfigPath,
    JSON.stringify({
      compilerOptions: {
        target: 'ESNext',
        module: 'ESNext',
        moduleResolution: 'bundler',
        strict: true,
        lib: ['ESNext', 'DOM'],
      },
    }),
  )
}
